{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\MUsoftware\\\\Desktop\\\\project\\\\MUsoftware\\\\mudev.cc\\\\src\\\\ui\\\\page\\\\playco\\\\playlistDetailPage.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { OverlayTrigger, Tooltip, Button } from 'react-bootstrap';\nimport ReactPlayer from 'react-player';\nimport Icon from '@mdi/react';\nimport { mdiPlus, mdiTools, mdiAccountCircle, mdiRefresh, mdiPlayCircle, mdiDelete } from '@mdi/js';\nimport { ListRow } from '../../common/element/muListRow';\nimport { Divider } from '../../common/element/divider';\nimport { PHButton } from '../../common/element/muButton';\nimport { PHFormText } from 'src/ui/common/element/muFormText';\nimport { PHAlertMessageBox } from 'src/ui/common/element/muAlertMsgBox';\nimport { YoutubeThumbnail } from '../../common/element/util/youtubeThumbnail';\nimport { PlaylistControlModal } from './element/playlistControlModal';\nimport { PlaylistItem, Playlist // PlaylistConfig\n} from './playco/model';\nimport './playlistDetailPage.css';\nimport { PlayCoAPI } from './playco/api';\nimport { PlayCoSocketIOHandler } from './playco/sio';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst isNumeric = val => /^\\d+$/.test(val);\n\nexport const PlaylistDetailDummyListener = () => /*#__PURE__*/_jsxDEV(\"div\", {\n  style: {\n    height: '16pt'\n  }\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 54,\n  columnNumber: 60\n}, this);\n_c = PlaylistDetailDummyListener;\nexport const PlaylistDetailListener = props => {\n  return /*#__PURE__*/_jsxDEV(OverlayTrigger, {\n    placement: \"bottom\",\n    overlay: tooltipProps => /*#__PURE__*/_jsxDEV(Tooltip, { ...tooltipProps,\n      children: props.nick\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 32\n    }, this),\n    children: /*#__PURE__*/_jsxDEV(Icon, {\n      path: mdiAccountCircle,\n      size: \"16pt\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 10\n  }, this);\n};\n_c2 = PlaylistDetailListener;\nexport const PlaylistDetailItem = props => {\n  var _props$selected, _props$playlistItemPa;\n\n  const isSelected = (_props$selected = props.selected) !== null && _props$selected !== void 0 ? _props$selected : false;\n  return /*#__PURE__*/_jsxDEV(ListRow, {\n    onClick: isSelected ? null : props.onClickFunc,\n    className: \"playCoPlaylistDetailListItem\",\n    itemWidth: [25, 70, 5],\n    style: {\n      // This cannot be moved to css,\n      // as we have to overwrite the element style of ListRow.\n      alignItems: 'center',\n      marginLeft: '0',\n      marginRight: '0',\n      borderRadius: '0.3rem',\n      ...(isSelected ? {\n        border: '1px solid rgba(255, 255, 255, 1)',\n        backgroundColor: 'rgba(0, 0, 0, 0.4)'\n      } : {\n        border: 'none'\n      })\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"playCoPlaylistDetailListItemThumbnailContainer\",\n      children: /*#__PURE__*/_jsxDEV(YoutubeThumbnail, {\n        youtubeId: props.playlistItemData.link_id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"playCoPlaylistDetailListItemInfoContainer\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"playCoPlaylistDetailListItemTitle\",\n        children: props.playlistItemData.name\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"playCoPlaylistDetailListItemListenerListContainer\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"playCoPlaylistDetailListItemListenerList\",\n          children: ((_props$playlistItemPa = props.playlistItemParticipantStatusData) === null || _props$playlistItemPa === void 0 ? void 0 : _props$playlistItemPa.length) ? props.playlistItemParticipantStatusData.map((value, index) => {\n            var _value$data;\n\n            return /*#__PURE__*/_jsxDEV(PlaylistDetailListener, {\n              nick: value.nickname,\n              imgUrl: (_value$data = value.data) === null || _value$data === void 0 ? void 0 : _value$data.img_url\n            }, `playco-playlist-detail-listitem-listener-${index}`, false, {\n              fileName: _jsxFileName,\n              lineNumber: 97,\n              columnNumber: 20\n            }, this);\n          }) : /*#__PURE__*/_jsxDEV(PlaylistDetailDummyListener, {}, `playco-playlist-detail-listitem-listener-0`, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"link\",\n        style: {\n          color: 'rgba(255, 255, 255, 1)'\n        },\n        onClick: e => {\n          e.stopPropagation();\n          props.onDeleteBtnClickFunc();\n        },\n        children: /*#__PURE__*/_jsxDEV(Icon, {\n          path: mdiDelete,\n          size: \"1.75rem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 10\n  }, this);\n};\n_c3 = PlaylistDetailItem;\nexport const PlaylistDetail = props => {\n  _s();\n\n  const [playlistDetailState, setPlaylistDetailState] = useState({\n    newItemUrlTextFieldValue: '',\n    newItemUrlNotUsableReason: ''\n  });\n\n  const onAddPlaylistItemBtnClick = () => {\n    props.addPlaylistItemFunc(playlistDetailState.newItemUrlTextFieldValue).then(result => setPlaylistDetailState({ ...playlistDetailState,\n      ...(result !== null && result !== void 0 ? result : {})\n    }));\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"aside\", {\n    className: \"playCoPlaylistDetailList\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      children: /*#__PURE__*/_jsxDEV(\"h5\", {\n        className: \"playCoPlaylistDetailListTitleContainer\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"playCoPlaylistDetailListTitle\",\n          children: props.playlistData.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          className: \"rounded-circle playCoPlaylistDetailListRefreshButton\",\n          variant: \"info\",\n          style: {\n            padding: '0.05rem'\n          },\n          disabled: props.disabled,\n          onClick: props.refreshPlaylistDataFunc,\n          children: /*#__PURE__*/_jsxDEV(OverlayTrigger, {\n            placement: \"bottom\",\n            overlay: tooltipProps => /*#__PURE__*/_jsxDEV(Tooltip, { ...tooltipProps,\n              children: [\"\\uC7AC\\uC0DD\\uBAA9\\uB85D\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 154,\n                columnNumber: 71\n              }, this), \"\\uC0C8\\uB85C\\uACE0\\uCE68\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 40\n            }, this),\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"playCoPlaylistDetailListRefreshButtonIconContainer\",\n              children: /*#__PURE__*/_jsxDEV(Icon, {\n                path: mdiRefresh,\n                size: \"1.75rem\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 156,\n                columnNumber: 15\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(Divider, {\n      style: {\n        margin: 'unset',\n        marginLeft: '0',\n        marginRight: '0',\n        marginTop: '1.25rem',\n        marginBottom: '1.25rem',\n        width: '100%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 5\n    }, this), props.socketIoConnectionStatusState && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(PHFormText, {\n        showOnlyNeeded: true,\n        children: props.socketIoConnectionStatusState\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Divider, {\n        style: {\n          marginLeft: 0,\n          marginRight: 0,\n          marginTop: '1rem',\n          marginBottom: '1rem',\n          width: '100%'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true), /*#__PURE__*/_jsxDEV(\"input\", {\n      title: \"Add item on playlist\",\n      placeholder: \"\\uC7AC\\uC0DD\\uBAA9\\uB85D\\uC5D0 \\uCD94\\uAC00\\uD560 URL\",\n      className: \"playCoPlaylistDetailAddTextField\",\n      disabled: props.disabled,\n      value: playlistDetailState.newItemUrlTextFieldValue,\n      onChange: evt => setPlaylistDetailState({ ...playlistDetailState,\n        newItemUrlTextFieldValue: evt.target.value,\n        newItemUrlNotUsableReason: ''\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(PHFormText, {\n      showOnlyNeeded: true,\n      children: playlistDetailState.newItemUrlNotUsableReason\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"playCoPlaylistDetailBtnGroup\",\n      children: [/*#__PURE__*/_jsxDEV(PHButton, {\n        smaller: true,\n        variant: \"outline-warning\",\n        disabled: props.disabled,\n        onClick: () => props.setPlaylistModifyModalShowStateFunc(true),\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          path: mdiTools,\n          size: \"1.1rem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 9\n        }, this), \"\\xA0\\xA0\\uC7AC\\uC0DD\\uBAA9\\uB85D \\uC124\\uC815\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(PHButton, {\n        smaller: true,\n        variant: \"outline-info\",\n        disabled: props.disabled,\n        onClick: onAddPlaylistItemBtnClick,\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          path: mdiPlus,\n          size: \"1.1rem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 9\n        }, this), \"\\xA0\\xA0\\uC7AC\\uC0DD\\uBAA9\\uB85D\\uC5D0 \\uCD94\\uAC00\\uD558\\uAE30\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(Divider, {\n      style: {\n        margin: 'unset',\n        marginLeft: '0',\n        marginRight: '0',\n        marginTop: '1.25rem',\n        marginBottom: '1.25rem',\n        width: '100%'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: props.playlistData.items.length ? props.playlistData.items.map((value, index) => {\n        var _props$participantSta;\n\n        return /*#__PURE__*/_jsxDEV(PlaylistDetailItem, {\n          onClickFunc: props.disabled ? () => {\n            /* */\n          } : () => props.setPlaylistCurrentPlayingStateFunc(index),\n          onDeleteBtnClickFunc: props.disabled ? () => {\n            /* */\n          } : () => props.deletePlaylistItemFunc(index),\n          playlistItemData: value,\n          playlistItemParticipantStatusData: (_props$participantSta = props.participantStatus) === null || _props$participantSta === void 0 ? void 0 : _props$participantSta.get(index),\n          selected: index === props.currentPlayingIndex\n        }, `playco-playlist-detail-listitem-${value.uuid}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 58\n        }, this);\n      }) : /*#__PURE__*/_jsxDEV(ListRow, {\n        style: {\n          width: '100%',\n          marginRight: '0',\n          marginLeft: '0',\n          border: 'none'\n        },\n        children: \"\\uC7AC\\uC0DD\\uBAA9\\uB85D\\uC5D0 \\uC544\\uBB34 \\uAC83\\uB3C4 \\uC5C6\\uC5B4\\uC694...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 140,\n    columnNumber: 10\n  }, this);\n};\n\n_s(PlaylistDetail, \"AHRKFDr6fiGaxekengYX4Z0qsE4=\");\n\n_c4 = PlaylistDetail;\nexport const PlaylistDetailPlayer = props => {\n  const playerConfig = {\n    youtube: {\n      playerVars: {\n        autoplay: props.autoplay ? 1 : 0,\n        loop: props.loopMode === 1 ? 1 : 0,\n        showinfo: 1,\n        controls: 1\n      }\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"aside\", {\n    className: \"playCoPlaylistDetailPlayerAside\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"playCoPlaylistDetailPlayerContainer\",\n      children: /*#__PURE__*/_jsxDEV(ReactPlayer, {\n        controls: true,\n        pip: true,\n        className: \"playCoPlaylistDetailPlayer\",\n        width: \"100%\",\n        height: \"100%\",\n        config: playerConfig,\n        url: props.targetUrl,\n        loop: props.loopMode === 1,\n        playing: props.autoplay,\n        onEnded: props.loopMode ? props.onPlayerEndedFunc : null\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"playCoPlaylistDetailPlayerBtnGroup\",\n      children: [/*#__PURE__*/_jsxDEV(PHButton, {\n        variant: props.autoplay ? 'info' : 'outline-info',\n        onClick: () => props.setAutoplayStateFunc(!props.autoplay),\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          path: mdiPlayCircle,\n          size: \"1.1rem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 9\n        }, this), \"\\xA0\\xA0\\uC790\\uB3D9 \\uC7AC\\uC0DD\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(PHButton, {\n        variant: props.loopMode === 0 ? 'outline-info' : 'info',\n        onClick: props.setLoopModeStateFunc,\n        children: [/*#__PURE__*/_jsxDEV(Icon, {\n          path: mdiRefresh,\n          size: \"1.1rem\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 9\n        }, this), \"\\xA0\\xA0\", props.loopMode === 0 ? '반복  해제됨' // loopMode === 0\n        : props.loopMode === 1 ? '한곡 반복 중' // loopMode === 1\n        : props.loopMode === 2 ? '전곡 반복 중' // loopMode === 2\n        : '전곡 한번만 재생 중' // loopMode === 3\n        ]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 243,\n    columnNumber: 10\n  }, this);\n};\n_c5 = PlaylistDetailPlayer;\nexport const PlayCoPlaylistDetail = () => {\n  _s2();\n\n  var _playlistDetailRootSt;\n\n  const params = useParams();\n  const navigate = useNavigate();\n  const [playlistDetailRootState, setPlaylistDetailRootState] = useState({\n    playlistData: new Playlist({\n      uuid: -1,\n      index: 0,\n      name: '정보를 불러오는 중...',\n      public_accessable: false,\n      public_modifiable: false,\n      public_item_appendable: false,\n      public_item_orderable: false,\n      public_item_deletable: false,\n      allow_duplicate: false,\n      items: [new PlaylistItem({\n        uuid: -1,\n        index: 0,\n        name: '정보를 불러오는 중이에요, 잠시만 기다려주세요...',\n        data: {},\n        added_by_uuid: -1,\n        added_by_nick: '',\n        link: '',\n        link_type: '',\n        link_id: '',\n        current_listener: []\n      })]\n    }),\n    participantStatus: new Map(),\n    showPlaylistModifyModal: false,\n    showAlertMessageBoxModal: false,\n    alertMessageBoxModalData: {\n      title: '',\n      body: '',\n      onAcceptBtnClick: () => {\n        /* */\n      }\n    },\n    autoplay: false,\n    // FIXME: TODO: change this to true\n    // 0: loop disabled\n    // 1: loop one item\n    // 2: loop all items in playlist, and loop again if the last item in playlist played.\n    // 3: loop all items in playlist, and stop if the last item in playlist played.\n    loopMode: 3,\n    currentPlayingIndex: 0,\n    currentPlayingUrl: '',\n    isFirstInitialized: false,\n    isAccountFetching: false,\n    isPlaylistFetching: false,\n    socketIoConnectionStatus: ''\n  });\n  const defaultAlertMsgModalData = {\n    title: '재생목록을 불러올 수 없어요...',\n    body: '',\n    onAcceptBtnClick: () => navigate('/playco')\n  };\n\n  const refreshPlaylistData = () => {\n    if (playlistDetailRootState.isAccountFetching || playlistDetailRootState.isPlaylistFetching) return;\n    setPlaylistDetailRootState(prevState => ({ ...prevState,\n      isPlaylistFetching: true\n    })); // Fetch playlist from API\n\n    PlayCoAPI.getPlaylistInfo(params.playlistId).then(result => setPlaylistDetailRootState(prevState => {\n      var _result$items$0$link, _result$items$;\n\n      return { ...prevState,\n        isFirstInitialized: true,\n        isPlaylistFetching: false,\n        playlistData: result,\n        // Update playlist state if this is the first time the playlist information is loading\n        // or there's a new item added on a playlist when the playlist was empty\n        ...(prevState.playlistData.uuid === -1 || prevState.playlistData.items.length === 0 ? {\n          currentPlayingUrl: (_result$items$0$link = (_result$items$ = result.items[0]) === null || _result$items$ === void 0 ? void 0 : _result$items$.link) !== null && _result$items$0$link !== void 0 ? _result$items$0$link : '',\n          currentPlayingIndex: 0\n        } : {})\n      };\n    }), reason => setPlaylistDetailRootState(prevState => ({ ...prevState,\n      isPlaylistFetching: false,\n      showAlertMessageBoxModal: true,\n      alertMessageBoxModalData: { ...defaultAlertMsgModalData,\n        body: reason.message\n      }\n    })));\n  };\n\n  const setPlaylistLoopModeState = () => {\n    setPlaylistDetailRootState({ ...playlistDetailRootState,\n      loopMode: playlistDetailRootState.loopMode <= 0 ? 3 : playlistDetailRootState.loopMode - 1\n    });\n  };\n\n  const setPlaylistModifyModalShowState = newState => {\n    if (!playlistDetailRootState.playlistData || playlistDetailRootState.playlistData.uuid <= 0 || playlistDetailRootState.isAccountFetching || playlistDetailRootState.isPlaylistFetching) return;\n    setPlaylistDetailRootState({ ...playlistDetailRootState,\n      showPlaylistModifyModal: newState\n    }); // Re-fetch playlist data when config modal closed.\n\n    if (!newState) refreshPlaylistData();\n  };\n\n  const setPlaylistCurrentPlayingState = newIndex => {\n    if (0 > newIndex || newIndex > playlistDetailRootState.playlistData.items.length - 1) return;\n    const newPlayerLink = playlistDetailRootState.playlistData.items != 0 ? playlistDetailRootState.playlistData.items[newIndex].link : '';\n    setPlaylistDetailRootState({ ...playlistDetailRootState,\n      currentPlayingIndex: newIndex,\n      currentPlayingUrl: newPlayerLink\n    });\n  };\n\n  const setPlaylistCurrentPlayingStateToNext = () => {\n    if (playlistDetailRootState.currentPlayingIndex + 1 >= playlistDetailRootState.playlistData.items.length) {\n      if (playlistDetailRootState.loopMode === 2) setPlaylistCurrentPlayingState(0);\n      return;\n    }\n\n    setPlaylistCurrentPlayingState(playlistDetailRootState.currentPlayingIndex + 1);\n  };\n\n  const addPlaylistItem = newItemUrl => {\n    var _newItemUrl;\n\n    if (!playlistDetailRootState.playlistData || playlistDetailRootState.playlistData.uuid <= 0 || playlistDetailRootState.isAccountFetching || playlistDetailRootState.isPlaylistFetching) return;\n    newItemUrl = ((_newItemUrl = newItemUrl) !== null && _newItemUrl !== void 0 ? _newItemUrl : '').trim();\n    if (!newItemUrl) return new Promise(resolve => resolve({\n      newItemUrlTextFieldValue: newItemUrl,\n      newItemUrlNotUsableReason: '재생목록에 추가할 URL을 적어주세요!'\n    }));\n    setPlaylistDetailRootState(prevState => ({ ...prevState,\n      isPlaylistFetching: true\n    }));\n    return PlayCoAPI.insertPlaylistItem(playlistDetailRootState.playlistData.uuid, newItemUrl, playlistDetailRootState.playlistData.hash).then(result => {\n      setPlaylistDetailRootState(prevState => ({ ...prevState,\n        isPlaylistFetching: false\n      }));\n\n      if (!result.success) {\n        let errorMsg = null;\n        let shouldUrlTextFieldCleared = false;\n\n        if (result.subCode === 'resource.forbidden') {\n          errorMsg = '재생목록에 추가할 수 있는 권한이 없어요.';\n        } else if (result.subCode === 'resource.prediction_failed') {\n          var _result$data$predicti, _result$data$predicti2, _result$data$predicti3;\n\n          if ((_result$data$predicti = result.data.prediction_failed_reason) === null || _result$data$predicti === void 0 ? void 0 : _result$data$predicti.includes('playlist_outdated')) {\n            errorMsg = '재생목록에 수정사항이 생겼어요,\\n상단의 \"새로고침\" 버튼을 눌러주세요.';\n          } else if ((_result$data$predicti2 = result.data.prediction_failed_reason) === null || _result$data$predicti2 === void 0 ? void 0 : _result$data$predicti2.includes('link_not_implemented')) {\n            shouldUrlTextFieldCleared = true;\n            errorMsg = '지금은 YouTube 영상만 지원해요,\\n다른 영상의 URL을 시도해주세요.';\n          } else if ((_result$data$predicti3 = result.data.prediction_failed_reason) === null || _result$data$predicti3 === void 0 ? void 0 : _result$data$predicti3.includes('link_data_fetch_failed')) {\n            errorMsg = '영상의 정보를 확인할 수 없어요,\\n다른 URL을 시도하시거나 10분 후 다시 시도해주세요.';\n          } else {\n            errorMsg = '알 수 없는 문제가 생겼어요,\\n상단의 \"새로고침\" 버튼을 눌러주세요.';\n          }\n        } else if (result.subCode === 'resource.unique_failed') {\n          errorMsg = '이미 재생목록에 해당 영상이 포함되어 있어요,\\n';\n          errorMsg += '만약 재생목록에 중복해서 포함하고 싶으시다면\\n';\n          errorMsg += '\"재생목록 설정\"에서 설정을 바꿔주세요.';\n        } else if (result.subCode === 'resource.not_found') {\n          // Show an alertbox and kick to main screen\n          setPlaylistDetailRootState(prevState => ({ ...prevState,\n            isPlaylistFetching: false,\n            showAlertMessageBoxModal: true,\n            alertMessageBoxModalData: { ...defaultAlertMsgModalData,\n              body: /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [\"\\uC874\\uC7AC\\uD558\\uC9C0 \\uC54A\\uB294 \\uC7AC\\uC0DD\\uBAA9\\uB85D ID\\uC785\\uB2C8\\uB2E4,\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 468,\n                  columnNumber: 47\n                }, this), \"ID\\uB97C \\uD655\\uC778 \\uD6C4 \\uB2E4\\uC2DC \\uC2DC\\uB3C4\\uD574\\uC8FC\\uC138\\uC694.\"]\n              }, void 0, true)\n            }\n          }));\n        } else {\n          errorMsg = '알 수 없는 문제가 생겼어요,\\n상단의 \"새로고침\" 버튼을 눌러주세요.';\n        } // Don't erase url input field, so that user can try once more.\n\n\n        return { ...(shouldUrlTextFieldCleared ? {\n            newItemUrlTextFieldValue: ''\n          } : {}),\n          newItemUrlNotUsableReason: errorMsg\n        };\n      }\n\n      refreshPlaylistData();\n      return {\n        newItemUrlTextFieldValue: '',\n        newItemUrlNotUsableReason: ''\n      };\n    }, reason => {\n      setPlaylistDetailRootState(prevState => ({ ...prevState,\n        isPlaylistFetching: false\n      }));\n      return {\n        newItemUrlNotUsableReason: reason.message\n      };\n    });\n  };\n\n  const deletePlaylistItem = index => {\n    if (!playlistDetailRootState.playlistData || playlistDetailRootState.playlistData.uuid <= 0 || playlistDetailRootState.isAccountFetching || playlistDetailRootState.isPlaylistFetching) return;\n    setPlaylistDetailRootState(prevState => ({ ...prevState,\n      isPlaylistFetching: true\n    }));\n    PlayCoAPI.deletePlaylistItem(playlistDetailRootState.playlistData.uuid, index, playlistDetailRootState.playlistData.hash).then(result => {\n      if (playlistDetailRootState.currentPlayingIndex >= index) {\n        // Fetch playlist items after deleting item,\n        // and set playlist data while doing minus 1 on currentPlayingIndex not to change currentPlayingUrl,\n        // as \"one item before current playing item\" or \"current playing item\" is gone, and we don't want to refresh player.\n        setPlaylistDetailRootState(prevState => ({ ...prevState,\n          currentPlayingIndex: prevState.currentPlayingIndex - 1\n        }));\n      } else {// Update playlist data state after deleting item and ignore it.\n        // Deleting item after current playing item won't affect our player.\n      }\n\n      refreshPlaylistData();\n    }, reason => {\n      setPlaylistDetailRootState(prevState => ({ ...prevState,\n        newItemUrlNotUsableReason: reason.message,\n        isPlaylistFetching: false\n      }));\n    });\n  }; // Socket.IO specific event handler\n\n\n  const onPlaylistUserStateModified = newRoomState => {\n    console.log('onPlaylistUserStateModified called!');\n    console.log(newRoomState); // Convert PlayCoRoomType to PlaylistParticipantStateType\n\n    const newParticipantState = new Map();\n    if (playlistDetailRootState.playlistData.uuid != newRoomState.playlist_id) return;\n\n    for (const [nickname, roomStatus] of Object.entries(newRoomState.participants)) {\n      var _newParticipantState$;\n\n      const currentStateIndex = roomStatus.status.currently_playing;\n\n      if (!newParticipantState.has(currentStateIndex)) {\n        newParticipantState.set(currentStateIndex, []);\n      }\n\n      (_newParticipantState$ = newParticipantState.get(currentStateIndex)) === null || _newParticipantState$ === void 0 ? void 0 : _newParticipantState$.push({\n        nickname: nickname,\n        data: roomStatus.data\n      });\n    }\n\n    setPlaylistDetailRootState(prevState => ({ ...prevState,\n      participantStatus: newParticipantState\n    }));\n  };\n\n  const onSocketIOStatusChanged = newSIOStateMessage => {\n    setPlaylistDetailRootState(prevState => ({ ...prevState,\n      socketIoConnectionStatus: newSIOStateMessage\n    }));\n  };\n\n  const playCoSocketIO = new PlayCoSocketIOHandler();\n\n  playCoSocketIO.onPlayCoConnected = () => {\n    // Try to connect SocketIO and fetch participant status.\n    playCoSocketIO.enterPlaylist(playlistDetailRootState.playlistData.uuid);\n  };\n\n  playCoSocketIO.onSocketIOStatusChanged = onSocketIOStatusChanged;\n  playCoSocketIO.onPlaylistModified = refreshPlaylistData;\n  playCoSocketIO.onUserStatusChanged = onPlaylistUserStateModified;\n  useEffect(() => {\n    // Check if params.playlistId is a valid numeric value\n    if (!isNumeric(params.playlistId)) {\n      setPlaylistDetailRootState({ ...playlistDetailRootState,\n        showAlertMessageBoxModal: true,\n        alertMessageBoxModalData: { ...defaultAlertMsgModalData,\n          body: /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [\"\\uC62C\\uBC14\\uB974\\uC9C0 \\uC54A\\uC740 \\uC7AC\\uC0DD\\uBAA9\\uB85D ID\\uC785\\uB2C8\\uB2E4,\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 573,\n              columnNumber: 39\n            }, this), \"ID\\uB97C \\uD655\\uC778 \\uD6C4 \\uB2E4\\uC2DC \\uC2DC\\uB3C4\\uD574\\uC8FC\\uC138\\uC694.\"]\n          }, void 0, true)\n        }\n      });\n      return;\n    } // Initialize and fetch playlist data\n\n\n    if ((!playlistDetailRootState.playlistData || playlistDetailRootState.playlistData.uuid <= 0) && !playlistDetailRootState.isAccountFetching && !playlistDetailRootState.isPlaylistFetching) refreshPlaylistData();\n    return () => {\n      // Page unmounted\n      // Try to leave SocketIO room.\n      // playCoSocketIO.leavePlaylist(playlistDetailRootState.playlistData.uuid);\n      playCoSocketIO.disconnect(true);\n    };\n  }, []);\n  useEffect(() => {\n    if (playlistDetailRootState.isFirstInitialized) {\n      playCoSocketIO.connect();\n    }\n  }, [playlistDetailRootState.isFirstInitialized]);\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"playCoPlaylistDetailPage\",\n    children: [/*#__PURE__*/_jsxDEV(PHAlertMessageBox, {\n      variant: \"error\",\n      modalShowState: playlistDetailRootState.showAlertMessageBoxModal,\n      setModalShowState: newState => setPlaylistDetailRootState({ ...playlistDetailRootState,\n        showAlertMessageBoxModal: newState\n      }),\n      ...((_playlistDetailRootSt = playlistDetailRootState.alertMessageBoxModalData) !== null && _playlistDetailRootSt !== void 0 ? _playlistDetailRootSt : {})\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 598,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"header\", {\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: [\"PlayCO\", /*#__PURE__*/_jsxDEV(\"sup\", {\n          className: \"playCoTitleHeaderSup\",\n          children: \"Alpha\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 604,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 604,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"\\uD50C\\uB808\\uC774\\uB9AC\\uC2A4\\uD2B8\\uB97C, \\uBA40\\uB9AC\\uC11C, \\uB2E4 \\uAC19\\uC774\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 605,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 603,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"playCoPlaylistDetail\",\n      children: [/*#__PURE__*/_jsxDEV(PlaylistControlModal, {\n        initialModalState: playlistDetailRootState.playlistData,\n        modalShowState: playlistDetailRootState.showPlaylistModifyModal,\n        setModalShowState: setPlaylistModifyModalShowState\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(PlaylistDetail, {\n        playlistData: playlistDetailRootState.playlistData,\n        participantStatus: playlistDetailRootState.participantStatus,\n        currentPlayingIndex: playlistDetailRootState.currentPlayingIndex,\n        socketIoConnectionStatusState: playlistDetailRootState.socketIoConnectionStatus,\n        disabled: !playlistDetailRootState.playlistData || playlistDetailRootState.playlistData.uuid <= 0 || playlistDetailRootState.isAccountFetching || playlistDetailRootState.isPlaylistFetching,\n        setPlaylistModifyModalShowStateFunc: setPlaylistModifyModalShowState,\n        setPlaylistCurrentPlayingStateFunc: setPlaylistCurrentPlayingState,\n        addPlaylistItemFunc: addPlaylistItem,\n        deletePlaylistItemFunc: deletePlaylistItem,\n        refreshPlaylistDataFunc: refreshPlaylistData\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 612,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(PlaylistDetailPlayer, {\n        targetUrl: playlistDetailRootState.currentPlayingUrl,\n        loopMode: playlistDetailRootState.loopMode,\n        setLoopModeStateFunc: setPlaylistLoopModeState,\n        autoplay: playlistDetailRootState.autoplay,\n        setAutoplayStateFunc: newState => setPlaylistDetailRootState({ ...playlistDetailRootState,\n          autoplay: newState\n        }),\n        onPlayerEndedFunc: setPlaylistCurrentPlayingStateToNext\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 628,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 607,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 597,\n    columnNumber: 10\n  }, this);\n};\n\n_s2(PlayCoPlaylistDetail, \"x5BsTEKwhMjgoUS/b3ITWjSnGD0=\", false, function () {\n  return [useParams, useNavigate];\n});\n\n_c6 = PlayCoPlaylistDetail;\n\nvar _c, _c2, _c3, _c4, _c5, _c6;\n\n$RefreshReg$(_c, \"PlaylistDetailDummyListener\");\n$RefreshReg$(_c2, \"PlaylistDetailListener\");\n$RefreshReg$(_c3, \"PlaylistDetailItem\");\n$RefreshReg$(_c4, \"PlaylistDetail\");\n$RefreshReg$(_c5, \"PlaylistDetailPlayer\");\n$RefreshReg$(_c6, \"PlayCoPlaylistDetail\");","map":{"version":3,"sources":["C:/Users/MUsoftware/Desktop/project/MUsoftware/mudev.cc/src/ui/page/playco/playlistDetailPage.tsx"],"names":["React","useState","useEffect","useParams","useNavigate","OverlayTrigger","Tooltip","Button","ReactPlayer","Icon","mdiPlus","mdiTools","mdiAccountCircle","mdiRefresh","mdiPlayCircle","mdiDelete","ListRow","Divider","PHButton","PHFormText","PHAlertMessageBox","YoutubeThumbnail","PlaylistControlModal","PlaylistItem","Playlist","PlayCoAPI","PlayCoSocketIOHandler","isNumeric","val","test","PlaylistDetailDummyListener","height","PlaylistDetailListener","props","tooltipProps","nick","PlaylistDetailItem","isSelected","selected","onClickFunc","alignItems","marginLeft","marginRight","borderRadius","border","backgroundColor","playlistItemData","link_id","name","playlistItemParticipantStatusData","length","map","value","index","nickname","data","img_url","color","e","stopPropagation","onDeleteBtnClickFunc","PlaylistDetail","playlistDetailState","setPlaylistDetailState","newItemUrlTextFieldValue","newItemUrlNotUsableReason","onAddPlaylistItemBtnClick","addPlaylistItemFunc","then","result","playlistData","padding","disabled","refreshPlaylistDataFunc","margin","marginTop","marginBottom","width","socketIoConnectionStatusState","evt","target","setPlaylistModifyModalShowStateFunc","items","setPlaylistCurrentPlayingStateFunc","deletePlaylistItemFunc","participantStatus","get","currentPlayingIndex","uuid","PlaylistDetailPlayer","playerConfig","youtube","playerVars","autoplay","loop","loopMode","showinfo","controls","targetUrl","onPlayerEndedFunc","setAutoplayStateFunc","setLoopModeStateFunc","PlayCoPlaylistDetail","params","navigate","playlistDetailRootState","setPlaylistDetailRootState","public_accessable","public_modifiable","public_item_appendable","public_item_orderable","public_item_deletable","allow_duplicate","added_by_uuid","added_by_nick","link","link_type","current_listener","Map","showPlaylistModifyModal","showAlertMessageBoxModal","alertMessageBoxModalData","title","body","onAcceptBtnClick","currentPlayingUrl","isFirstInitialized","isAccountFetching","isPlaylistFetching","socketIoConnectionStatus","defaultAlertMsgModalData","refreshPlaylistData","prevState","getPlaylistInfo","playlistId","reason","message","setPlaylistLoopModeState","setPlaylistModifyModalShowState","newState","setPlaylistCurrentPlayingState","newIndex","newPlayerLink","setPlaylistCurrentPlayingStateToNext","addPlaylistItem","newItemUrl","trim","Promise","resolve","insertPlaylistItem","hash","success","errorMsg","shouldUrlTextFieldCleared","subCode","prediction_failed_reason","includes","deletePlaylistItem","onPlaylistUserStateModified","newRoomState","console","log","newParticipantState","playlist_id","roomStatus","Object","entries","participants","currentStateIndex","status","currently_playing","has","set","push","onSocketIOStatusChanged","newSIOStateMessage","playCoSocketIO","onPlayCoConnected","enterPlaylist","onPlaylistModified","onUserStatusChanged","disconnect","connect"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { OverlayTrigger, Tooltip, Button } from 'react-bootstrap';\r\nimport ReactPlayer from 'react-player';\r\nimport Icon from '@mdi/react';\r\nimport { mdiPlus, mdiTools, mdiAccountCircle, mdiRefresh, mdiPlayCircle, mdiDelete } from '@mdi/js';\r\n\r\nimport { ListRow } from '../../common/element/muListRow';\r\nimport { Divider } from '../../common/element/divider';\r\nimport { PHButton } from '../../common/element/muButton';\r\nimport { PHFormText } from 'src/ui/common/element/muFormText';\r\nimport { PHAlertMessageBox } from 'src/ui/common/element/muAlertMsgBox';\r\nimport { YoutubeThumbnail } from '../../common/element/util/youtubeThumbnail';\r\n\r\nimport { FrostError } from 'src/common/error';\r\nimport { PlaylistControlModal } from './element/playlistControlModal';\r\nimport {\r\n  PlaylistListener,\r\n  PlaylistItem,\r\n  Playlist,\r\n  // PlaylistConfig\r\n} from './playco/model';\r\nimport './playlistDetailPage.css';\r\nimport { PlayCoAPI } from './playco/api';\r\nimport { PlayCoSocketIOHandler, PlayCoRoomType } from './playco/sio';\r\n\r\ntype PlaylistItemParticipantStateType = Array<{\r\n  nickname: string;\r\n  data?: Record<string, unknown>;\r\n}>;\r\n\r\ntype PlaylistParticipantStateType = Map<number, PlaylistItemParticipantStateType>;\r\n\r\ntype PlayCoPlaylistDetailStateType = {\r\n  playlistData: Playlist;\r\n  participantStatus: PlaylistParticipantStateType;\r\n  showPlaylistModifyModal: boolean;\r\n  showAlertMessageBoxModal: boolean;\r\n  alertMessageBoxModalData: { title: string; body: string; onAcceptBtnClick: () => void; };\r\n\r\n  autoplay: boolean;\r\n  loopMode: number;\r\n  currentPlayingIndex: number;\r\n  currentPlayingUrl: string;\r\n\r\n  isAccountFetching: boolean;\r\n  isPlaylistFetching: boolean;\r\n\r\n  socketIoConnectionStatus: string;\r\n};\r\n\r\nconst isNumeric = (val) => (/^\\d+$/.test(val));\r\n\r\nexport const PlaylistDetailDummyListener: React.FC = () => <div style={{ height: '16pt' }} />;\r\nexport const PlaylistDetailListener: React.FC = (props: { nick: string; imgUrl?: string; }) => {\r\n  return <OverlayTrigger\r\n    placement='bottom'\r\n    overlay={(tooltipProps) => <Tooltip {...tooltipProps}>{props.nick}</Tooltip>} >\r\n    <Icon path={mdiAccountCircle} size='16pt' />\r\n  </OverlayTrigger>;\r\n};\r\n\r\nexport const PlaylistDetailItem: React.FC = (props: {\r\n  playlistItemData: PlaylistItem;\r\n  playlistItemParticipantStatusData?: PlaylistItemParticipantStateType;\r\n  onClickFunc: () => void;\r\n  onDeleteBtnClickFunc: () => void;\r\n  selected?: boolean;\r\n}) => {\r\n  const isSelected = props.selected ?? false;\r\n  return <ListRow\r\n    onClick={(isSelected) ? null : props.onClickFunc}\r\n    className='playCoPlaylistDetailListItem'\r\n    itemWidth={[25, 70, 5]}\r\n    style={{\r\n      // This cannot be moved to css,\r\n      // as we have to overwrite the element style of ListRow.\r\n      alignItems: 'center',\r\n      marginLeft: '0',\r\n      marginRight: '0',\r\n      borderRadius: '0.3rem',\r\n      ...(isSelected ? {\r\n        border: '1px solid rgba(255, 255, 255, 1)',\r\n        backgroundColor: 'rgba(0, 0, 0, 0.4)',\r\n      } : {\r\n        border: 'none',\r\n      })\r\n    }}>\r\n    <div className='playCoPlaylistDetailListItemThumbnailContainer'>\r\n      <YoutubeThumbnail youtubeId={props.playlistItemData.link_id} />\r\n    </div>\r\n    <div className='playCoPlaylistDetailListItemInfoContainer'>\r\n      <div className='playCoPlaylistDetailListItemTitle'>{props.playlistItemData.name}</div>\r\n      <div className='playCoPlaylistDetailListItemListenerListContainer'>\r\n        <div className='playCoPlaylistDetailListItemListenerList'>\r\n          {(props.playlistItemParticipantStatusData?.length) ? (props.playlistItemParticipantStatusData.map((value, index) => {\r\n            return <PlaylistDetailListener\r\n              key={`playco-playlist-detail-listitem-listener-${index}`}\r\n              nick={value.nickname}\r\n              imgUrl={value.data?.img_url} />\r\n          })) : <PlaylistDetailDummyListener\r\n            key={`playco-playlist-detail-listitem-listener-0`} />}\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div>\r\n      <Button\r\n        variant='link'\r\n        style={{ color: 'rgba(255, 255, 255, 1)' }}\r\n        onClick={(e) => { e.stopPropagation(); props.onDeleteBtnClickFunc(); }} >\r\n        <Icon path={mdiDelete} size='1.75rem' />\r\n      </Button>\r\n    </div>\r\n  </ListRow>;\r\n};\r\nexport const PlaylistDetail: React.FC = (props: {\r\n  setPlaylistModifyModalShowStateFunc: (boolean) => void;\r\n  setPlaylistCurrentPlayingStateFunc: (number) => void;\r\n  deletePlaylistItemFunc: (number) => void;\r\n  refreshPlaylistDataFunc: () => void;\r\n  addPlaylistItemFunc?: (string) => Promise<{ newItemUrlTextFieldValue: string, newItemUrlNotUsableReason: string }>;\r\n  playlistData: Playlist;\r\n  participantStatus?: PlaylistParticipantStateType;\r\n  isSignedIn?: boolean;\r\n  disabled?: boolean;\r\n  currentPlayingIndex: number;\r\n  socketIoConnectionStatusState: string;\r\n}) => {\r\n  const [playlistDetailState, setPlaylistDetailState] = useState({\r\n    newItemUrlTextFieldValue: '',\r\n    newItemUrlNotUsableReason: '',\r\n  });\r\n  const onAddPlaylistItemBtnClick = () => {\r\n    props.addPlaylistItemFunc(playlistDetailState.newItemUrlTextFieldValue)\r\n      .then((result) => setPlaylistDetailState({\r\n        ...playlistDetailState,\r\n        ...(result ?? {})\r\n      }));\r\n  }\r\n  return <aside className='playCoPlaylistDetailList'>\r\n    <header>\r\n      <h5 className='playCoPlaylistDetailListTitleContainer'>\r\n        <div className='playCoPlaylistDetailListTitle'>\r\n          {props.playlistData.name}\r\n        </div>\r\n        <Button\r\n          className='rounded-circle playCoPlaylistDetailListRefreshButton'\r\n          variant='info'\r\n          style={{ padding: '0.05rem' }}\r\n          disabled={props.disabled}\r\n          onClick={props.refreshPlaylistDataFunc}>\r\n          <OverlayTrigger\r\n            placement='bottom'\r\n            overlay={(tooltipProps) => <Tooltip {...tooltipProps}>재생목록<br />새로고침</Tooltip>} >\r\n            <div className='playCoPlaylistDetailListRefreshButtonIconContainer'>\r\n              <Icon path={mdiRefresh} size='1.75rem' />\r\n            </div>\r\n          </OverlayTrigger>\r\n        </Button>\r\n      </h5>\r\n    </header>\r\n    <Divider style={{ margin: 'unset', marginLeft: '0', marginRight: '0', marginTop: '1.25rem', marginBottom: '1.25rem', width: '100%' }} />\r\n    {\r\n      props.socketIoConnectionStatusState && <>\r\n        <PHFormText showOnlyNeeded>{props.socketIoConnectionStatusState}</PHFormText>\r\n        <Divider\r\n          style={{\r\n            marginLeft: 0,\r\n            marginRight: 0,\r\n            marginTop: '1rem',\r\n            marginBottom: '1rem',\r\n            width: '100%',\r\n          }} />\r\n      </>\r\n    }\r\n    <input\r\n      title='Add item on playlist'\r\n      placeholder='재생목록에 추가할 URL'\r\n      className='playCoPlaylistDetailAddTextField'\r\n      disabled={props.disabled}\r\n      value={playlistDetailState.newItemUrlTextFieldValue}\r\n      onChange={(evt) => setPlaylistDetailState({\r\n        ...playlistDetailState,\r\n        newItemUrlTextFieldValue: evt.target.value,\r\n        newItemUrlNotUsableReason: '',\r\n      })}\r\n    ></input>\r\n    <PHFormText showOnlyNeeded>{playlistDetailState.newItemUrlNotUsableReason}</PHFormText>\r\n    <div className='playCoPlaylistDetailBtnGroup'>\r\n      <PHButton\r\n        smaller\r\n        variant='outline-warning'\r\n        disabled={props.disabled}\r\n        onClick={() => props.setPlaylistModifyModalShowStateFunc(true)}>\r\n        <Icon path={mdiTools} size='1.1rem' />&nbsp;&nbsp;재생목록 설정\r\n      </PHButton>\r\n      <PHButton\r\n        smaller\r\n        variant='outline-info'\r\n        disabled={props.disabled}\r\n        onClick={onAddPlaylistItemBtnClick} >\r\n        <Icon path={mdiPlus} size='1.1rem' />&nbsp;&nbsp;재생목록에 추가하기\r\n      </PHButton>\r\n    </div>\r\n    <Divider style={{ margin: 'unset', marginLeft: '0', marginRight: '0', marginTop: '1.25rem', marginBottom: '1.25rem', width: '100%' }} />\r\n    <div>\r\n      {(props.playlistData.items.length)\r\n        ? props.playlistData.items.map((value, index) => <PlaylistDetailItem\r\n          key={`playco-playlist-detail-listitem-${value.uuid}`}\r\n          onClickFunc={props.disabled\r\n            ? () => { /* */ }\r\n            : () => props.setPlaylistCurrentPlayingStateFunc(index)}\r\n          onDeleteBtnClickFunc={props.disabled\r\n            ? () => { /* */ }\r\n            : () => props.deletePlaylistItemFunc(index)}\r\n          playlistItemData={value}\r\n          playlistItemParticipantStatusData={props.participantStatus?.get(index)}\r\n          selected={index === props.currentPlayingIndex} />)\r\n        : <ListRow style={{ width: '100%', marginRight: '0', marginLeft: '0', border: 'none' }}>재생목록에 아무 것도 없어요...</ListRow>}\r\n    </div>\r\n  </aside>;\r\n};\r\n\r\nexport const PlaylistDetailPlayer: React.FC = (props: {\r\n  targetUrl: string;\r\n  autoplay: boolean;\r\n  loopMode: number;\r\n  setAutoplayStateFunc: (boolean) => void;\r\n  setLoopModeStateFunc: () => void;\r\n  onPlayerEndedFunc?: () => void;\r\n}) => {\r\n  const playerConfig = {\r\n    youtube: {\r\n      playerVars: {\r\n        autoplay: props.autoplay ? 1 : 0,\r\n        loop: props.loopMode === 1 ? 1 : 0,\r\n        showinfo: 1,\r\n        controls: 1,\r\n      }\r\n    }\r\n  };\r\n\r\n  return <aside className='playCoPlaylistDetailPlayerAside'>\r\n    <div className='playCoPlaylistDetailPlayerContainer'>\r\n      <ReactPlayer\r\n        controls pip\r\n        className='playCoPlaylistDetailPlayer'\r\n        width='100%' height='100%'\r\n        config={playerConfig}\r\n\r\n        url={props.targetUrl}\r\n        loop={props.loopMode === 1}\r\n        playing={props.autoplay}\r\n        onEnded={(props.loopMode) ? props.onPlayerEndedFunc : null} />\r\n    </div>\r\n    <br />\r\n    <div className='playCoPlaylistDetailPlayerBtnGroup'>\r\n      <PHButton\r\n        variant={(props.autoplay) ? 'info' : 'outline-info'}\r\n        onClick={() => props.setAutoplayStateFunc(!props.autoplay)} >\r\n        <Icon path={mdiPlayCircle} size='1.1rem' />&nbsp;&nbsp;자동 재생\r\n      </PHButton>\r\n\r\n      <PHButton\r\n        variant={(props.loopMode === 0) ? 'outline-info' : 'info'}\r\n        onClick={props.setLoopModeStateFunc} >\r\n        <Icon path={mdiRefresh} size='1.1rem' />\r\n        &nbsp;&nbsp;{\r\n          (props.loopMode === 0)\r\n            ? '반복  해제됨' // loopMode === 0\r\n            : (props.loopMode === 1)\r\n              ? '한곡 반복 중' // loopMode === 1\r\n              : (props.loopMode === 2)\r\n                ? '전곡 반복 중' // loopMode === 2\r\n                : '전곡 한번만 재생 중' // loopMode === 3\r\n        }\r\n      </PHButton>\r\n    </div>\r\n  </aside>;\r\n};\r\n\r\nexport const PlayCoPlaylistDetail: React.FC = () => {\r\n  const params = useParams();\r\n  const navigate = useNavigate();\r\n  const [playlistDetailRootState, setPlaylistDetailRootState] = useState<PlayCoPlaylistDetailStateType>({\r\n    playlistData: new Playlist({\r\n      uuid: -1,\r\n      index: 0,\r\n      name: '정보를 불러오는 중...',\r\n\r\n      public_accessable: false,\r\n      public_modifiable: false,\r\n      public_item_appendable: false,\r\n      public_item_orderable: false,\r\n      public_item_deletable: false,\r\n      allow_duplicate: false,\r\n\r\n      items: [\r\n        new PlaylistItem({\r\n          uuid: -1,\r\n          index: 0,\r\n          name: '정보를 불러오는 중이에요, 잠시만 기다려주세요...',\r\n          data: {},\r\n\r\n          added_by_uuid: -1,\r\n          added_by_nick: '',\r\n\r\n          link: '',\r\n          link_type: '',\r\n          link_id: '',\r\n          current_listener: [],\r\n        }),\r\n      ],\r\n    }),\r\n    participantStatus: new Map(),\r\n    showPlaylistModifyModal: false,\r\n    showAlertMessageBoxModal: false,\r\n    alertMessageBoxModalData: { title: '', body: '', onAcceptBtnClick: () => { /* */ }, },\r\n\r\n    autoplay: false, // FIXME: TODO: change this to true\r\n    // 0: loop disabled\r\n    // 1: loop one item\r\n    // 2: loop all items in playlist, and loop again if the last item in playlist played.\r\n    // 3: loop all items in playlist, and stop if the last item in playlist played.\r\n    loopMode: 3,\r\n    currentPlayingIndex: 0,\r\n    currentPlayingUrl: '',\r\n\r\n    isFirstInitialized: false,\r\n    isAccountFetching: false,\r\n    isPlaylistFetching: false,\r\n\r\n    socketIoConnectionStatus: '',\r\n  });\r\n  const defaultAlertMsgModalData = {\r\n    title: '재생목록을 불러올 수 없어요...',\r\n    body: '',\r\n    onAcceptBtnClick: () => navigate('/playco'),\r\n  }\r\n\r\n  const refreshPlaylistData = () => {\r\n    if (playlistDetailRootState.isAccountFetching || playlistDetailRootState.isPlaylistFetching)\r\n      return;\r\n\r\n    setPlaylistDetailRootState((prevState) => ({ ...prevState, isPlaylistFetching: true, }));\r\n\r\n    // Fetch playlist from API\r\n    PlayCoAPI\r\n      .getPlaylistInfo(params.playlistId)\r\n      .then(\r\n        (result) => setPlaylistDetailRootState((prevState) => ({\r\n          ...prevState,\r\n          isFirstInitialized: true,\r\n          isPlaylistFetching: false,\r\n          playlistData: result,\r\n\r\n          // Update playlist state if this is the first time the playlist information is loading\r\n          // or there's a new item added on a playlist when the playlist was empty\r\n          ...((prevState.playlistData.uuid === -1 || prevState.playlistData.items.length === 0) ? {\r\n            currentPlayingUrl: result.items[0]?.link ?? '',\r\n            currentPlayingIndex: 0,\r\n          } : {}),\r\n        })),\r\n        (reason: FrostError) => setPlaylistDetailRootState((prevState) => ({\r\n          ...prevState,\r\n          isPlaylistFetching: false,\r\n          showAlertMessageBoxModal: true,\r\n          alertMessageBoxModalData: {\r\n            ...defaultAlertMsgModalData,\r\n            body: reason.message,\r\n          },\r\n        }))\r\n      )\r\n  }\r\n  const setPlaylistLoopModeState = () => {\r\n    setPlaylistDetailRootState({\r\n      ...playlistDetailRootState,\r\n      loopMode: (playlistDetailRootState.loopMode <= 0) ? 3 : playlistDetailRootState.loopMode - 1,\r\n    });\r\n  }\r\n  const setPlaylistModifyModalShowState = (newState: boolean) => {\r\n    if (!playlistDetailRootState.playlistData\r\n      || playlistDetailRootState.playlistData.uuid <= 0\r\n      || playlistDetailRootState.isAccountFetching\r\n      || playlistDetailRootState.isPlaylistFetching)\r\n      return;\r\n\r\n    setPlaylistDetailRootState({\r\n      ...playlistDetailRootState,\r\n      showPlaylistModifyModal: newState,\r\n    });\r\n\r\n    // Re-fetch playlist data when config modal closed.\r\n    if (!newState) refreshPlaylistData();\r\n  };\r\n  const setPlaylistCurrentPlayingState = (newIndex: number) => {\r\n    if (0 > newIndex || newIndex > playlistDetailRootState.playlistData.items.length - 1)\r\n      return;\r\n\r\n    const newPlayerLink = (playlistDetailRootState.playlistData.items != 0) ? playlistDetailRootState.playlistData.items[newIndex].link : '';\r\n    setPlaylistDetailRootState({\r\n      ...playlistDetailRootState,\r\n      currentPlayingIndex: newIndex,\r\n      currentPlayingUrl: newPlayerLink,\r\n    });\r\n  }\r\n  const setPlaylistCurrentPlayingStateToNext = () => {\r\n    if (playlistDetailRootState.currentPlayingIndex + 1 >= playlistDetailRootState.playlistData.items.length) {\r\n      if (playlistDetailRootState.loopMode === 2)\r\n        setPlaylistCurrentPlayingState(0);\r\n      return;\r\n    }\r\n    setPlaylistCurrentPlayingState(playlistDetailRootState.currentPlayingIndex + 1);\r\n  }\r\n\r\n  const addPlaylistItem = (newItemUrl: string) => {\r\n    if (!playlistDetailRootState.playlistData\r\n      || playlistDetailRootState.playlistData.uuid <= 0\r\n      || playlistDetailRootState.isAccountFetching\r\n      || playlistDetailRootState.isPlaylistFetching)\r\n      return;\r\n\r\n    newItemUrl = (newItemUrl ?? '').trim();\r\n    if (!newItemUrl)\r\n      return new Promise((resolve) => resolve({\r\n        newItemUrlTextFieldValue: newItemUrl,\r\n        newItemUrlNotUsableReason: '재생목록에 추가할 URL을 적어주세요!',\r\n      }));\r\n\r\n    setPlaylistDetailRootState((prevState) => ({ ...prevState, isPlaylistFetching: true, }));\r\n\r\n    return PlayCoAPI.insertPlaylistItem(\r\n      playlistDetailRootState.playlistData.uuid,\r\n      newItemUrl,\r\n      playlistDetailRootState.playlistData.hash)\r\n      .then(\r\n        (result) => {\r\n          setPlaylistDetailRootState((prevState) => ({ ...prevState, isPlaylistFetching: false, }));\r\n          if (!result.success) {\r\n            let errorMsg: string | null = null;\r\n            let shouldUrlTextFieldCleared = false;\r\n\r\n            if (result.subCode === 'resource.forbidden') {\r\n              errorMsg = '재생목록에 추가할 수 있는 권한이 없어요.';\r\n            } else if (result.subCode === 'resource.prediction_failed') {\r\n              if (result.data.prediction_failed_reason?.includes('playlist_outdated')) {\r\n                errorMsg = '재생목록에 수정사항이 생겼어요,\\n상단의 \"새로고침\" 버튼을 눌러주세요.';\r\n              } else if (result.data.prediction_failed_reason?.includes('link_not_implemented')) {\r\n                shouldUrlTextFieldCleared = true;\r\n                errorMsg = '지금은 YouTube 영상만 지원해요,\\n다른 영상의 URL을 시도해주세요.';\r\n              } else if (result.data.prediction_failed_reason?.includes('link_data_fetch_failed')) {\r\n                errorMsg = '영상의 정보를 확인할 수 없어요,\\n다른 URL을 시도하시거나 10분 후 다시 시도해주세요.';\r\n              } else {\r\n                errorMsg = '알 수 없는 문제가 생겼어요,\\n상단의 \"새로고침\" 버튼을 눌러주세요.';\r\n              }\r\n            } else if (result.subCode === 'resource.unique_failed') {\r\n              errorMsg = '이미 재생목록에 해당 영상이 포함되어 있어요,\\n'\r\n              errorMsg += '만약 재생목록에 중복해서 포함하고 싶으시다면\\n';\r\n              errorMsg += '\"재생목록 설정\"에서 설정을 바꿔주세요.';\r\n            } else if (result.subCode === 'resource.not_found') {\r\n              // Show an alertbox and kick to main screen\r\n              setPlaylistDetailRootState((prevState) => ({\r\n                ...prevState,\r\n                isPlaylistFetching: false,\r\n                showAlertMessageBoxModal: true,\r\n                alertMessageBoxModalData: {\r\n                  ...defaultAlertMsgModalData,\r\n                  body: (<>존재하지 않는 재생목록 ID입니다,<br />ID를 확인 후 다시 시도해주세요.</>),\r\n                },\r\n              }));\r\n            } else {\r\n              errorMsg = '알 수 없는 문제가 생겼어요,\\n상단의 \"새로고침\" 버튼을 눌러주세요.';\r\n            }\r\n\r\n            // Don't erase url input field, so that user can try once more.\r\n            return {\r\n              ...(shouldUrlTextFieldCleared ? { newItemUrlTextFieldValue: '', } : {}),\r\n              newItemUrlNotUsableReason: errorMsg,\r\n            };\r\n          }\r\n\r\n          refreshPlaylistData();\r\n          return {\r\n            newItemUrlTextFieldValue: '',\r\n            newItemUrlNotUsableReason: '',\r\n          };\r\n        },\r\n        (reason: FrostError) => {\r\n          setPlaylistDetailRootState((prevState) => ({ ...prevState, isPlaylistFetching: false, }));\r\n          return { newItemUrlNotUsableReason: reason.message, };\r\n        });\r\n  };\r\n  const deletePlaylistItem = (index: number) => {\r\n    if (!playlistDetailRootState.playlistData\r\n      || playlistDetailRootState.playlistData.uuid <= 0\r\n      || playlistDetailRootState.isAccountFetching\r\n      || playlistDetailRootState.isPlaylistFetching)\r\n      return;\r\n\r\n    setPlaylistDetailRootState((prevState) => ({ ...prevState, isPlaylistFetching: true, }));\r\n\r\n    PlayCoAPI.deletePlaylistItem(\r\n      playlistDetailRootState.playlistData.uuid,\r\n      index,\r\n      playlistDetailRootState.playlistData.hash)\r\n      .then(\r\n        (result) => {\r\n          if (playlistDetailRootState.currentPlayingIndex >= index) {\r\n            // Fetch playlist items after deleting item,\r\n            // and set playlist data while doing minus 1 on currentPlayingIndex not to change currentPlayingUrl,\r\n            // as \"one item before current playing item\" or \"current playing item\" is gone, and we don't want to refresh player.\r\n            setPlaylistDetailRootState((prevState) => ({\r\n              ...prevState,\r\n              currentPlayingIndex: prevState.currentPlayingIndex - 1,\r\n            }));\r\n          } else {\r\n            // Update playlist data state after deleting item and ignore it.\r\n            // Deleting item after current playing item won't affect our player.\r\n          }\r\n          refreshPlaylistData();\r\n        },\r\n        (reason: FrostError) => {\r\n          setPlaylistDetailRootState((prevState) => ({\r\n            ...prevState,\r\n            newItemUrlNotUsableReason: reason.message,\r\n            isPlaylistFetching: false,\r\n          }));\r\n        }\r\n      );\r\n  }\r\n\r\n  // Socket.IO specific event handler\r\n  const onPlaylistUserStateModified = (newRoomState: PlayCoRoomType) => {\r\n    console.log('onPlaylistUserStateModified called!');\r\n    console.log(newRoomState);\r\n    // Convert PlayCoRoomType to PlaylistParticipantStateType\r\n    const newParticipantState: PlaylistParticipantStateType = new Map();\r\n\r\n    if (playlistDetailRootState.playlistData.uuid != newRoomState.playlist_id)\r\n      return;\r\n\r\n    for (const [nickname, roomStatus] of Object.entries(newRoomState.participants)) {\r\n      const currentStateIndex = roomStatus.status.currently_playing;\r\n      if (!newParticipantState.has(currentStateIndex)) {\r\n        newParticipantState.set(currentStateIndex, []);\r\n      }\r\n      newParticipantState.get(currentStateIndex)?.push({ nickname: nickname, data: roomStatus.data, });\r\n    }\r\n\r\n    setPlaylistDetailRootState((prevState) => ({ ...prevState, participantStatus: newParticipantState, }))\r\n  };\r\n  const onSocketIOStatusChanged = (newSIOStateMessage: string) => {\r\n    setPlaylistDetailRootState((prevState) => ({ ...prevState, socketIoConnectionStatus: newSIOStateMessage, }));\r\n  };\r\n\r\n  const playCoSocketIO = new PlayCoSocketIOHandler();\r\n  playCoSocketIO.onPlayCoConnected = () => {\r\n    // Try to connect SocketIO and fetch participant status.\r\n    playCoSocketIO.enterPlaylist(playlistDetailRootState.playlistData.uuid);\r\n  };\r\n  playCoSocketIO.onSocketIOStatusChanged = onSocketIOStatusChanged;\r\n  playCoSocketIO.onPlaylistModified = refreshPlaylistData;\r\n  playCoSocketIO.onUserStatusChanged = onPlaylistUserStateModified;\r\n\r\n  useEffect(() => {\r\n    // Check if params.playlistId is a valid numeric value\r\n    if (!isNumeric(params.playlistId)) {\r\n      setPlaylistDetailRootState({\r\n        ...playlistDetailRootState,\r\n        showAlertMessageBoxModal: true,\r\n        alertMessageBoxModalData: {\r\n          ...defaultAlertMsgModalData,\r\n          body: (<>올바르지 않은 재생목록 ID입니다,<br />ID를 확인 후 다시 시도해주세요.</>),\r\n        },\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Initialize and fetch playlist data\r\n    if ((!playlistDetailRootState.playlistData || playlistDetailRootState.playlistData.uuid <= 0)\r\n      && !playlistDetailRootState.isAccountFetching && !playlistDetailRootState.isPlaylistFetching)\r\n      refreshPlaylistData();\r\n\r\n    return () => { // Page unmounted\r\n      // Try to leave SocketIO room.\r\n      // playCoSocketIO.leavePlaylist(playlistDetailRootState.playlistData.uuid);\r\n      playCoSocketIO.disconnect(true);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (playlistDetailRootState.isFirstInitialized) {\r\n      playCoSocketIO.connect();\r\n    }\r\n  }, [playlistDetailRootState.isFirstInitialized])\r\n\r\n  return <section className='playCoPlaylistDetailPage'>\r\n    <PHAlertMessageBox\r\n      variant='error'\r\n      modalShowState={playlistDetailRootState.showAlertMessageBoxModal}\r\n      setModalShowState={(newState: boolean) => setPlaylistDetailRootState({ ...playlistDetailRootState, showAlertMessageBoxModal: newState })}\r\n      {...(playlistDetailRootState.alertMessageBoxModalData ?? {})} />\r\n    <header>\r\n      <h2>PlayCO<sup className='playCoTitleHeaderSup'>Alpha</sup></h2>\r\n      <p>플레이리스트를, 멀리서, 다 같이</p>\r\n    </header>\r\n    <div className='playCoPlaylistDetail'>\r\n      <PlaylistControlModal\r\n        initialModalState={playlistDetailRootState.playlistData}\r\n        modalShowState={playlistDetailRootState.showPlaylistModifyModal}\r\n        setModalShowState={setPlaylistModifyModalShowState} />\r\n      <PlaylistDetail\r\n        playlistData={playlistDetailRootState.playlistData}\r\n        participantStatus={playlistDetailRootState.participantStatus}\r\n        currentPlayingIndex={playlistDetailRootState.currentPlayingIndex}\r\n        socketIoConnectionStatusState={playlistDetailRootState.socketIoConnectionStatus}\r\n        disabled={\r\n          !playlistDetailRootState.playlistData\r\n          || playlistDetailRootState.playlistData.uuid <= 0\r\n          || playlistDetailRootState.isAccountFetching\r\n          || playlistDetailRootState.isPlaylistFetching\r\n        }\r\n        setPlaylistModifyModalShowStateFunc={setPlaylistModifyModalShowState}\r\n        setPlaylistCurrentPlayingStateFunc={setPlaylistCurrentPlayingState}\r\n        addPlaylistItemFunc={addPlaylistItem}\r\n        deletePlaylistItemFunc={deletePlaylistItem}\r\n        refreshPlaylistDataFunc={refreshPlaylistData} />\r\n      <PlaylistDetailPlayer\r\n        targetUrl={playlistDetailRootState.currentPlayingUrl}\r\n        loopMode={playlistDetailRootState.loopMode}\r\n        setLoopModeStateFunc={setPlaylistLoopModeState}\r\n        autoplay={playlistDetailRootState.autoplay}\r\n        setAutoplayStateFunc={(newState) => setPlaylistDetailRootState({ ...playlistDetailRootState, autoplay: newState })}\r\n        onPlayerEndedFunc={setPlaylistCurrentPlayingStateToNext} />\r\n    </div>\r\n  </section>;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}